<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<script src="../../bower_components/jstat/dist/jstat.min.js"></script>

<link rel="import" href="./d-continuous.html">
<link rel="import" href="./d-info.html">

<dom-module id="d-normal-distribution">
  <template>
    <style>
    :host {
      display: block;
    }

    #settings {
      width: 500px;
      display: flex;
      justify-content: space-around;
      margin-bottom: 24px;
    }

    app-toolbar {
      background: coral;
      color: white;
    }

    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    </style>

  <app-toolbar>
    <div main-title spacer>正态分布（Normal Distribution）</div>
    <paper-icon-button icon="info"></paper-icon-button>
  </app-toolbar>

  <div id="container">
    <div id="settings">
      <paper-input label="Mean" type="number" value="{{distributionMean}}"></paper-input>
      <paper-input label="Standard Deviation" type="number" value="{{distributionSD}}"></paper-input>
    </div>
    <d-info mean="[[distributionMean]]" std="[[distributionSD]]" variance="[[distributionVariance]]"></d-info>
    <d-continuous id="continuous"></d-continuous>
  </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'd-normal-distribution',
        properties: {
          distributionMean: {
            value: 0,
            type: Number,
            notify: true
          },

          distributionSD: {
            value: 1,
            type: Number,
            notify: true
          },

          distributionVariance: {
            type: Number,
            computed: '_computeVariance(distributionSD)'
          }
        },

        observers: [
          '_redraw(distributionMean, distributionSD)'
        ],

        _computeVariance(distributionSD) {
          return distributionSD * distributionSD;
        },

        _redraw(distributionMean, distributionSD) {
          this.$.continuous.data = this._createData(distributionMean, distributionSD);
        },

        _createData(mean, std) {
          mean = +mean;
          std = +std;
          let data = [];

          for (let i = 0; i < 100000; i++) {
            let normal = window.jStat.normal(mean, std);
            let q = normal.sample();
            let p = normal.pdf(q);
            let el = {
                'q': q,
                'p': p
            };
            data.push(el);
          };

          data.sort(function(x, y) {
              return x.q - y.q;
          });

          return data;
        }
      });
    })();
  </script>
</dom-module>
